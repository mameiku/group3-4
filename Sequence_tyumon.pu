@startuml
!theme toy

actor 顧客
participant "注文画面\n: Boundary" as Boundary_OrderForm
participant "注文制御\n: Control" as Control_Order
participant "決済制御\n: Control" as Control_Payment
boundary "決済システム\n: External" as External_Payment
database "注文データ\n: Entity" as Entity_Order
database "商品データ\n: Entity" as Entity_Product
participant "通知サービス\n: System" as Service_Notification

' 1-4. 注文確定まで (画面操作)
顧客 -> Boundary_OrderForm : 1-4. 注文情報を入力し[確定]
activate Boundary_OrderForm

' 5. 注文制御開始 (検証を含む)
Boundary_OrderForm -> Control_Order : 5. 注文確定要求
deactivate Boundary_OrderForm
activate Control_Order

' 6-7. 決済連携
Control_Order -> Control_Payment : 6. 決済処理要求
activate Control_Payment
Control_Payment -> External_Payment : 6.1. 支払い実行
activate External_Payment
External_Payment --> Control_Payment : 7. 決済完了通知
deactivate External_Payment
Control_Payment --> Control_Order : 7.1. 決済完了報告
deactivate Control_Payment

' 8. 注文情報の確定・登録
Control_Order -> Entity_Order : 8. 注文情報登録
activate Entity_Order
Entity_Order --> Control_Order : 8.1. 登録完了
deactivate Entity_Order

' 9. 在庫数の更新（実在庫減算）
Control_Order -> Entity_Product : 9. 実在庫数更新(減算)
activate Entity_Product
Entity_Product --> Control_Order : 9.1. 更新完了
deactivate Entity_Product

' 10. 注文完了画面表示とメール送信
Control_Order -> Service_Notification : 10.1. 注文確認メール送信
activate Service_Notification
Service_Notification --> Control_Order : 10.2. 送信完了
deactivate Service_Notification

Control_Order -> Boundary_OrderForm : 10.3. 注文完了表示要求
deactivate Control_Order
activate Boundary_OrderForm

Boundary_OrderForm -> 顧客 : 11. 注文完了画面を表示
deactivate Boundary_OrderForm
@enduml