@startuml AddToCartSequenceDiagram_LoggedOut
!theme toy

' ====================================================================
' Participant Definitions
' ====================================================================
actor User
boundary GoodsDetailJSP as "Product Detail Screen"
control AddCartJSP as "Add to Cart Controller"
control CustomerJava as "Customer Service"
boundary LoginJSP as "Login Screen"
control GoodsJava as "Product Service"
control CartJava as "Cart Service"
boundary AddCartCompleteJSP as "Cart Complete Screen"
boundary ErrorJSP as "Error Screen"

' ====================================================================
' Basic Flow: User is logged out (Pre-condition is NOT met)
' ====================================================================

' 1. The customer specifies the quantity on the product detail screen and selects 'Add to Cart'.
User -> GoodsDetailJSP : 1. Select 'Add to Cart' (Product ID, Quantity)
activate GoodsDetailJSP

GoodsDetailJSP -> AddCartJSP : Cart Add Request (Product ID, Quantity)
deactivate GoodsDetailJSP
activate AddCartJSP

' --- Login Check ---
' 2. The system confirms if the customer is logged in.
AddCartJSP -> CustomerJava : Get Login Information()
activate CustomerJava
CustomerJava --> AddCartJSP : Login Information (Logged Out User / Null)
deactivate CustomerJava

alt [User is Logged Out]
    ' Alternative Flow 2-1: If the customer is not logged in, the system confirms this.
    ' Alternative Flow 2-2: The system redirects to the Login Screen.
    AddCartJSP -> LoginJSP : Redirect to Login Screen
    activate LoginJSP
    
    LoginJSP --> User : Display Login Screen
    
    Note right : User performs the 'Login' Use Case here.\nUpon successful login, they will be redirected to the Cart/Product.
    
    deactivate LoginJSP
    
else [User is Logged In (Fallback)]
    ' This path represents the original Basic Flow, which should not be triggered if the pre-condition is 'logged out'.
    
    ' 2. Check Stock
    AddCartJSP -> GoodsJava : Check Stock (Product ID, Quantity)
    activate GoodsJava
    GoodsJava --> AddCartJSP : Stock Information
    deactivate GoodsJava
    
    ' ... followed by the rest of the Add to Cart logic ...
    
end ' End Login Check alt

deactivate AddCartJSP

@enduml
